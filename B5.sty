% Defines a custom LaTeX package named B5
\ProvidesPackage{B5}

% Import the ltablex package for extended functionality for tables
\usepackage{ltablex}

% Define lengths for indentation in various contexts
\newlength\leaderIndent
\setlength{\leaderIndent}{1.5em}

% Set vertical gap
\setlength{\vgap}{1.5em}

% Set vertical indentation
\setlength{\vindent}{\leaderIndent}

% Set vertical left margin
\setlength{\vleftmargin}{2em}

% Set paragraph skip and indent
\setlength{\parskip}{5pt}
\setlength{\parindent}{0pt}

% Redefine the 'center' environment with custom formatting
\renewenvironment{center}%
{\list{}{%
		\parskip 0pt%
		\topsep 6pt%
		\listparindent 0em%
		\itemindent    0pt%
		\leftmargin    0pt %\leaderIndent%
		\rightmargin   0pt%
		\parsep        0pt}
	\fontsize{15}{12}\selectfont
	\item[] \centering}%
{\endlist}

% ░█▀█░█▀█░█░░░▀█▀
% ░█▀▀░█▀█░█░░░░█░
% ░▀░░░▀░▀░▀▀▀░▀▀▀

% 'Handa mayaṁ...``
\newenvironment{leader}%
{\list{}{%
		\parskip 10pt%
		\topsep -2pt%
		\listparindent 0em%
		\itemindent    0pt%
		\leftmargin    0pt %\leaderIndent%
		\rightmargin   0pt%
		\parsep        0pt
	}%
	\fontsize{15}{14}\selectfont
	\item[] \centering}%
{\endlist}

\newenvironment{leader-only}%
{\list{}{%
		\parskip 4pt%
		\topsep 2pt%
		\listparindent 0em%
		\itemindent    0pt%
		\leftmargin    0pt %\leaderIndent%
		\rightmargin   0pt%
		\parsep        0pt%
	}%
	\fontsize{15}{12}\selectfont
	\item[] \centering}%
{\endlist}



% Specific formatting found in 'Devā-ārādhanā' / 'Invitations to the Devas'
\newenvironment{leader-pharitvana}%
{\list{}{%
		\parskip 12pt%
		\topsep 0pt%
		\listparindent 0em%
		\itemindent    0pt%
		\leftmargin    0.5cm %\leaderIndent%
		% \leftmargin    4.0cm %\leaderIndent%
		\rightmargin   0.5cm%
		\parsep        \z@ \@plus\p@%
	}%
	\fontsize{15}{22}\selectfont
	\item[] \centering}%
{\endlist}

% Pali introductions or phrases that are only chanted by the leader
\newenvironment{leader-pali}%
{\list{}{%
		\parskip 10pt%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    0em %2.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{15}{22}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \centering}%
{\endlist}

% Formatting for verses
\newenvironment{verses}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    0em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{15}{22}\selectfont
		\parsep        0em %\z@ \@plus\p@%
	}%
	\item[] \raggedright}%
{\endlist}

\newenvironment{pali-hang}%
{\list{}{%
		\topsep 0pt
		\itemsep 3pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    0.5em %2.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{15}{22}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \raggedright}%
{\endlist}

% Enables a line to hang that is sandwiched within a paragraph
\newenvironment{pali-hang-together}%
{\list{}{%
		\parskip 10pt%
		\topsep -8pt
		\listparindent 0em%
		\itemindent    -0.75em%
		\leftmargin    0.75em %2.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{15}{22}\selectfont
		\parsep        -1pt %\z@ \@plus\p@%
	}%
	\item[] \raggedright}%
{\endlist}

% Continues the indentation from a previous 'pali-hang*' which indicates continuous chanting (found in 'Protective Recitations')
\newenvironment{pali-hang-continued}%
{\list{}{%
		\parskip 10pt%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    0.5em %2.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{15}{22}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \raggedright}%
{\endlist}

\newenvironment{pali-hang-first-line}%
{\list{}{%
		\partopsep 0pt
		\topsep 4pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    0.5em%\leaderIndent%
		\rightmargin   0em%
		\fontsize{15}{16}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \raggedright}%
{\endlist}

% ░█▀▀░█▀█░█▀▀░█░░░▀█▀░█▀▀░█░█
% ░█▀▀░█░█░█░█░█░░░░█░░▀▀█░█▀█
% ░▀▀▀░▀░▀░▀▀▀░▀▀▀░▀▀▀░▀▀▀░▀░▀

% 'Now let us...'
\newenvironment{leader-english}%
{\list{}{%
		\parskip 7.5pt%
		\topsep 0pt%
		\listparindent 0em%
		\itemindent    0pt%
		\leftmargin    0pt %\leaderIndent%
		\rightmargin   0pt%
		\parsep        0pt
		\fontsize{14.5}{14}\selectfont
	}%
	\item[] \centering\itshape}%
{\endlist}

% Specific formatting found in 'Devā-ārādhanā' / 'Invitations to the Devas'
\newenvironment{leader-pharitvana-english}%
{\list{}{%
		\parskip 12pt%
		\topsep 0pt%
		\listparindent 0em%
		\itemindent    0pt%
		\leftmargin    0.5cm %\leaderIndent%
		% \leftmargin    4.0cm %\leaderIndent%
		\rightmargin   0.5cm%
		\parsep        \z@ \@plus\p@%
	}%
	\fontsize{14.5}{22}\selectfont
	\item[] \centering\itshape}%
{\endlist}

% Reduces above spacing for english leader when paired with a pali introduction
\newenvironment{leader-english-below-pali}%
{\list{}{%
		\parskip 10pt%
		\topsep -2pt%
		\listparindent 0em%
		\itemindent    0pt%
		\leftmargin    0pt %\leaderIndent%
		\rightmargin   0pt%
		\parsep        -8pt
		\fontsize{14.5}{14}\selectfont
	}%
	\item[] \centering\itshape}%
{\endlist}

% For English passages that are preceeded by Pāli, remains closer to the preceeding Pāli
\newenvironment{english}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    1.0em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        -8.5em %\z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% For chants like 'The Highest Blessings' which are English only and therefore don't need left margin indentation
\newenvironment{english-only}%
{\list{}{%
		% \parskip       8pt
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    0em%\leaderindent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		% \parsep        %\z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% For chants like 'The Gradual Training' which are English only yet need to be justified
\newenvironment{english-only-justify}%
{\list{}{%
		% \parskip       8pt
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    0em%\leaderindent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		% \parsep        %\z@ \@plus\p@%
	}%
	\item[] \justify\itshape}%
{\endlist}

% For an English line that is too long to fit on one line and thus needs its continuation to be hang indented
\newenvironment{english-hang}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    1.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        -8.5em %\z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% Enables an English line to hang that is sandwiched within a paragraph
\newenvironment{english-hang-together}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    0.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
		\parskip       -16pt
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% Wraps around the `english-hang-together` environment to allow the middle hang indent to keep congruent spacing
\newenvironment{english-keep-with}%
{\list{}{%
		\topsep 0pt
		\partopsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    1em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% For singular English lines that need hang indentation
\newenvironment{english-only-hang}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    0.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% Hanging format for chants that are only in English
\newenvironment{english-only-hang-together}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    0.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
		\parskip       -16pt
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% Similar to keep-with, wraps around `english-hang-together` but doesn't keep with previous paragraph
\newenvironment{english-only-no-hang}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    0em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% English introductions or phrases that are only chanted by the leader, found in chants that are only in English
\newenvironment{english-only-leader}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    0em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \centering\itshape}%
{\endlist}

% Used with with Pāli verses and parittas
\newenvironment{english-verses}%
{\list{}{%
		\partopsep 0pt
		\topsep 0pt
		\listparindent 0em%
		\itemindent    0em%
		\leftmargin    1.0em%\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{22}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% Used for THREE problematic line
\newenvironment{english-hang-first-line}%
{\list{}{%
		\partopsep 0pt
		\topsep 4pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    0.5em%\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% For an English line that is too long to fit on one line and thus needs its continuation to be hang indented
\newenvironment{english-hang-verses}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    1.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
		% \parsep        -8.5em %\z@ \@plus\p@%
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% Hanging format for English chants, primarily for verses
\newenvironment{english-hang-together-verses}%
{\list{}{%
		\topsep 0pt
		\listparindent 0em%
		\itemindent    -0.5em%
		\leftmargin    0.5em %\leaderIndent%
		\rightmargin   0em%
		\fontsize{14.5}{21}\selectfont
		\parsep        \z@ \@plus\p@%
		\parskip       -16pt
	}%
	\item[] \raggedright\itshape}%
{\endlist}

% ░█▀▀░█▀█░█▀▄░█▀█░█▀█░▀█▀░█▀▀░█▀▀
% ░█▀▀░█░█░█░█░█░█░█░█░░█░░█▀▀░▀▀█
% ░▀▀▀░▀░▀░▀▀░░▀░▀░▀▀▀░░▀░░▀▀▀░▀▀▀

% Changes the title for the Endnotes chapter
\renewcommand\notesname{Endnotes}

\renewcommand{\prenoteinnotes}{%
	\fontsize{11}{13}\selectfont\par\setlength{\parskip}{3pt}\noindent%
}%
\renewcommand{\noteidinnotes}[2]{% {notenum}{id}
	\begin{adjustwidth}{14pt}{0pt}%
		\hspace{-33pt}\makebox[30pt][l]{%
			\makebox[18pt][1]{#2}%
			\makebox[16pt][l]{\ifnum#1>0\footnotesize{#1}\fi%
			}%
		}%
		}%
		\renewcommand{\pageinnotes}[1]{}%
		\renewcommand{\postnotetext}{%
	\end{adjustwidth}%
}%
\renewcommand{\postnoteinnotes}{\par}%

% ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
% ░▄▄▄░▄▄▄░▄▄▄░▄▄▄░▄▄▄░▄▄▄░▄▄▄░▄▄▄
% ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

\newcommand\tr[1]{\textit{#1}}

\newcommand\trline[1]{%
	\begin{english}%
		#1%
	\end{english}%
}

% ░▀█▀░█▀█░█▀▄░█░█░█░░░█▀█░█▀▄
% ░░█░░█▀█░█▀▄░█░█░█░░░█▀█░█▀▄
% ░░▀░░▀░▀░▀▀░░▀▀▀░▀▀▀░▀░▀░▀░▀

\setlength{\tabcolsep}{1em}

\renewcommand{\arraystretch}{1.075}

\newcommand\oldArr{}% holding old \arraystretch for restore
\let\oldArr\arraystretch

\newcommand\setArrayStretch[1]{%
	\let\oldArr\arraystretch
	\renewcommand{\arraystretch}{#1}%
}

\newcommand\restoreArrayStretch{\let\arraystretch\oldArr}
